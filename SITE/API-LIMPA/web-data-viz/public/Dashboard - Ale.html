<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASHBOARD-Ale | RunGuard</title>
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/dashstyle.css">
    <link rel="stylesheet" href="css/style_ale.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    
</head>
<body>
    <button class="botao-chat" onclick="abrirChat()"><img style="width: 6vh;" src="imagens/robo.png" alt=""></button>
    
    <div id="janelaChat" class="janela-chat">
        <div class="cabecalho-chat">
            <div style="display: flex; align-items: center;">
                <img style="width: 100%;" src="imagens/robo-branco.png" alt="Perfil do assistente">
                <span style="font-size: 1.5em;">Guardinha</span>
            </div>
            <button style="background: none; border: none; color: white; cursor: pointer; font-size: 2em;" onclick="fecharChat()">᰽</button>
        </div>
        <div id="corpoChat" class="corpo-chat">
            <div class="mensagem assistente">
                Olá! <br>
                Me chamo Guardinha e sou a assistente virtual da RunGuard. <br>
                <b>Como posso ajudar?</b>
            </div>
            <div class="hora-mensagem assistente" id="horaDeAbertura"></div>
        </div>
        <div class="rodape-chat">
            <input type="text" id="entradaUsuario" placeholder="Escreva sua mensagem..." />
            <button onclick="gerarResposta()">⟹</button>
        </div>
    </div>

    <nav>
        <ul>
            <li>
                <a href="index.html" class="logo">
                    <img src="imagens/logo.png" alt="Logo RunGuard">
                    <span class="nav-item">RUNGUARD</span>
                </a>
            </li>
            <li><a href="index.html"><i class="fas fa-home"></i><span class="nav-item">Home</span></a></li>
            <li><a href="Dashboard - Ale.html"><i class="fas fa-chart-line"></i><span class="nav-item">Dashboard 1</span></a></li>
            <li><a href="Dashboard - Anne.html"><i class="fas fa-chart-bar"></i><span class="nav-item">Dashboard 2</span></a></li>
            <li><a href="Dashboard - Diego.html"><i class="fas fa-chart-pie"></i><span class="nav-item">Dashboard 3</span></a></li>
            <li><a href="Dashboard - Guilherme.html"><i class="fas fa-chart-column"></i><span class="nav-item">Dashboard 4</span></a></li>
            <li><a href="Dashboard - Ilys.html"><i class="fas fa-chart-simple"></i><span class="nav-item">Dashboard 5</span></a></li>
            <li><a href="Dashboard - Lucas.html"><i class="fas fa-chart-area"></i><span class="nav-item">Dashboard 6</span></a></li>
            <li><a href="insights-run-guard.pdf" download><i class="fas fa-file-pdf"></i><span class="nav-item">Baixe seus relatórios!</span></a></li>
            <li><a href="#" class="sair"><i class="fas fa-sign-out-alt"></i><span class="nav-item">Sair</span></a></li>
        </ul>
    </nav>

    <div id="charts-container">
        <div id="chart-bytes" class="chart"></div>
        <div id="chart-packets" class="chart"></div>
        <div id="chart-cpu" class="chart"></div>
        <div id="chart-pie" class="chart"></div>
    </div>

    <div class="alert-container">
        <div class="alert-content">
            <h2>Alertas de Monitoramento</h2>
            <p><strong>Perda na Última Hora:</strong></p>
            <p>Pacotes em risco: <span id="perdaPacotes" class="highlight"></span></p>
            <p>Bytes em risco: <span id="perdaBytes" class="highlight"></span></p>
            <p><strong>Eventos de Latência Alta:</strong></p>
            <p>Latência alta: <span id="pingAlerta" class="highlight"></span></p>
        </div>
    </div>



<script>
    function abrirChat() {
        document.getElementById("janelaChat").style.display = "flex";
    }

    function fecharChat() {
        document.getElementById("janelaChat").style.display = "none";
    }

    function obterHoraAtual() {
        const options = {
            timeZone: 'America/Sao_Paulo',
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
        };
        const agora = new Date();
        return agora.toLocaleTimeString('pt-BR', options);
    }

    async function gerarResposta() {
        const pergunta = document.getElementById('entradaUsuario').value;

        var entrada = document.getElementById("entradaUsuario");
        var mensagem = entrada.value.trim();

        const response = await fetch('/perguntar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ pergunta })
        });

        const data = await response.json();

        conversa.push(mensagem)
        conversa.push(data.resultado)

        if (mensagem !== "") {
            var mensagemUsuario = document.createElement("div");
            mensagemUsuario.classList.add("mensagem", "usuario");
            mensagemUsuario.innerText = mensagem;
            document.getElementById("corpoChat").appendChild(mensagemUsuario);

            var horaUsuario = document.createElement("div");
            horaUsuario.classList.add("hora-mensagem");
            horaUsuario.innerText = obterHoraAtual();
            document.getElementById("corpoChat").appendChild(horaUsuario);

            entrada.value = "";

            setTimeout(function () {
                var mensagemAssistente = document.createElement("div");
                mensagemAssistente.classList.add("mensagem", "assistente");
                mensagemAssistente.innerText = data.resultado;
                document.getElementById("corpoChat").appendChild(mensagemAssistente);

                var horaAssistente = document.createElement("div");
                horaAssistente.classList.add("hora-mensagem", "assistente");
                horaAssistente.innerText = obterHoraAtual();
                document.getElementById("corpoChat").appendChild(horaAssistente);

                document.getElementById("corpoChat").scrollTop = document.getElementById("corpoChat").scrollHeight;
            }, 1000);

            document.getElementById("corpoChat").scrollTop = document.getElementById("corpoChat").scrollHeight;
        }
    }

    // Função para monitorar dados enviados e recebidos
    function monitorarDados() {
    const minBytes = 1024 * 1024; // 1 MB em bytes
    const minPacotes = 10;
    const maxPing = 100; // Latência máxima permitida

    // Dados fictícios para teste
    const ping = 993;
    const bytesEnviados = 500000;
    const bytesRecebidos = 920000;
    const pacotesEnviados = 5;
    const pacotesRecebidos = 8;

    // Conversões para MB
    const bytesEnviadosMB = (bytesEnviados / (1024 * 1024)).toFixed(2);
    const bytesRecebidosMB = (bytesRecebidos / (1024 * 1024)).toFixed(2);

    // Referências aos elementos HTML
    const perdaBytesElem = document.getElementById("perdaBytes");
    const perdaPacotesElem = document.getElementById("perdaPacotes");
    const pingAlertaElem = document.getElementById("pingAlerta");

    // Inicializa mensagens
    let perdaBytesMsg = "";
    let perdaPacotesMsg = "";
    let pingMsg = "";

    // Verificações e acúmulo de alertas
    if (bytesEnviados < minBytes) {
        perdaBytesMsg += `${bytesEnviadosMB} MB enviados (Alerta: Abaixo de 1 MB)<br>`;
    }
    if (bytesRecebidos < minBytes) {
        perdaBytesMsg += `<br>${bytesRecebidosMB} MB recebidos (Alerta: Abaixo de 1 MB)<br>`;
    }
    if (pacotesEnviados < minPacotes) {
        perdaPacotesMsg += `<br>${pacotesEnviados} pacotes enviados (Alerta: Abaixo de 10 pacotes)<br>`;
    }
    if (pacotesRecebidos < minPacotes) {
        perdaPacotesMsg += `<br>${pacotesRecebidos} pacotes recebidos (Alerta: Abaixo de 10 pacotes)<br>`;
    }
    if (ping > maxPing) {
        pingMsg += `<br>${ping} ms (Alerta: Latência acima de 100 ms)<br>`;
    }

    
    // Atualiza os elementos HTML
    if (perdaBytesMsg) {
        perdaBytesElem.innerHTML = perdaBytesMsg;
        perdaBytesElem.style.color = "#E74C3C"; // Alerta em vermelho
    } else {
        perdaBytesElem.innerHTML = "Nenhum alerta";
        perdaBytesElem.style.color = "lightgreen"; // Sem alerta, texto em verde
    }

    if (perdaPacotesMsg) {
        perdaPacotesElem.innerHTML = perdaPacotesMsg;
        perdaPacotesElem.style.color = "#E74C3C"; // Alerta em vermelho
    } else {
        perdaPacotesElem.innerHTML = "Nenhum alerta";
        perdaPacotesElem.style.color = "lightgreen"; // Sem alerta, texto em verde
    }

    if (pingMsg) {
        pingAlertaElem.innerHTML = pingMsg;
        pingAlertaElem.style.color = "#E74C3C"; // Alerta em vermelho
    } else {
        pingAlertaElem.innerHTML = "Nenhum alerta";
        pingAlertaElem.style.color = "lightgreen"; // Sem alerta, texto em verde
    }
}


// Executa a função
monitorarDados();

    document.addEventListener('DOMContentLoaded', function () {
    var optionsBytes = {
        chart: {
            type: 'line',
            height: 350
        },
        series: [{
            name: 'Bytes Enviados',
            data: [300, 400, 350, 500, 490, 620, 690],
            color: '#FFC300' // Amarelo
        }, {
            name: 'Bytes Recebidos',
            data: [400, 430, 448, 470, 540, 580, 690],
            color: '#3498DB' // Azul
        }],
        xaxis: {
            categories: ['01:00', '02:00', '03:00', '04:00', '05:00', '06:00', '07:00']
        },
        title: {
            text: 'Monitoramento de Bytes',
            style: {
                color: '#FFFFFF'
            }
        },
        legend: {
            position: 'top',
            labels: {
                colors: ['#FFFFFF']
            }
        }
    };

    var chartBytes = new ApexCharts(document.querySelector("#chart-bytes"), optionsBytes);
    chartBytes.render();
});

function atualizarPacotes() {
    const pacotesEnviados = Math.floor(Math.random() * 200 +50); // Valores aleatórios
    const pacotesRecebidos = Math.floor(Math.random() * 200 + 50);

    const contadorEnviados = document.getElementById("contador-enviados");
    const contadorRecebidos = document.getElementById("contador-recebidos");

    // Atualizar o texto dos contadores
    contadorEnviados.innerText = pacotesEnviados + " Pacotes Enviados";
    contadorRecebidos.innerText = pacotesRecebidos + " Pacotes Recebidos";

    // Alterar a cor com base nos valores
    if (pacotesEnviados < 10) {
        contadorEnviados.style.color = "#E74C3"; // Vermelho para valores abaixo de 10
    } else {
        contadorEnviados.style.color = "#FFC300"; // Amarelo para valores iguais ou acima de 10
    }

    if (pacotesRecebidos < 10) {
        contadorRecebidos.style.color = "#E74C3"; // Vermelho para valores abaixo de 10
    } else {
        contadorRecebidos.style.color = "#3498DB"; // Azul para valores iguais ou acima de 10
    }
}
    // Atualização contínua a cada 2 segundos
    setInterval(atualizarPacotes, 2000);

    // Renderizar os contadores no lugar do gráfico de pacotes
    document.addEventListener('DOMContentLoaded', function () {
        const monitoramentoPacotes = document.getElementById("chart-packets");
        monitoramentoPacotes.innerHTML = `
            <div>
                <h2 style="color: #fff;">Monitoramento de Pacotes</h2>
                <p id="contador-enviados" style="color: #FFC300; font-size: 1.5rem;">0 Pacotes Enviados</p>
                <p id="contador-recebidos" style="color: #3498DB; font-size: 1.5rem;">0 Pacotes Recebidos</p>
            </div>
        `;
    });

// Gráfico de Utilização de CPU
var options = {
          series: [75],
          chart: {
          height: 430,
          type: 'radialBar',
          toolbar: {
            show: true
          }
        },
        plotOptions: {
          radialBar: {
            startAngle: -135,
            endAngle: 225,
             hollow: {
              margin: 0,
              size: '70%',
              background: '#fff',
              image: undefined,
              imageOffsetX: 0,
              imageOffsetY: 0,
              position: 'front',
              dropShadow: {
                enabled: true,
                top: 3,
                left: 0,
                blur: 4,
                opacity: 0.24
              }
            },
            track: {
              background: '#fff',
              strokeWidth: '67%',
              margin: 0, // margin is in pixels
              dropShadow: {
                enabled: true,
                top: -3,
                left: 0,
                blur: 4,
                opacity: 0.35
              }
            },
        
            dataLabels: {
              show: true,
              name: {
                offsetY: -10,
                show: true,
                color: '#888',
                fontSize: '17px'
              },
              value: {
                formatter: function(val) {
                  return parseInt(val);
                },
                color: '#111',
                fontSize: '36px',
                show: true,
              }
            }
          }
        },
        fill: {
          type: 'gradient',
          gradient: {
            shade: 'dark',
            type: 'horizontal',
            shadeIntensity: 0.5,
            gradientToColors: ['#ABE5A1'],
            inverseColors: true,
            opacityFrom: 1,
            opacityTo: 1,
            stops: [0, 100]
          }
        },
        title:{
            text: 'Utilização da CPU',
            style: {
                color: '#FFFFFF'
            }
        },
        stroke: {
          lineCap: 'round'
        },
        labels: ['Porcentagem da CPU'],
        };

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();

var chart = new ApexCharts(document.querySelector("#chart-cpu"), options);
chart.render();

// Gráfico de Pizza de Utilização de Memória
// Simula o contador de latência
function atualizarLatencia() {
    const latencia = Math.floor(Math.random() * 150); // Latência aleatória
    const contadorLatencia = document.getElementById("contador-latencia");

    contadorLatencia.innerText = `Latência: ${latencia}ms`;

    // Alterar a cor com base no valor da latência
    if (latencia > 100) {
        contadorLatencia.style.color = "#E74C3C"; // Vermelho para latências acima de 100ms
    } else {
        contadorLatencia.style.color = "lightgreen"; // Amarelo para latências abaixo ou igual a 100ms
    }
}

// Atualização contínua a cada 2 segundos
setInterval(atualizarLatencia, 2000);

// Renderizar o contador de latência no lugar do gráfico de CPU
document.addEventListener('DOMContentLoaded', function () {
    const utilizacaoCPU = document.getElementById("chart-pie");
    if (utilizacaoCPU) {
        utilizacaoCPU.innerHTML = `
            <div>
                <h2 style="color: #fff;">Monitoramento de Latência</h2>
                <p id="contador-latencia" style="color: yellow; font-size: 1.5rem;">Latência: 0ms</p>
            </div>
        `;
    }
});

</script>

</body>

</html>