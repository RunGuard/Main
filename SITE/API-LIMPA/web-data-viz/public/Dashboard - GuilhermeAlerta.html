<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASHBOARD-GUILHERMEALERTA | RunGuard</title>
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/style_duarte.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>

<body>
    <button class="botao-chat" onclick="abrirChat()"><img style="width: 6vh;" src="imagens/robo.png" alt=""></button>

    <div id="janelaChat" class="janela-chat">
        <div class="cabecalho-chat">
            <div style="display: flex; align-items: center;">
                <img style="width: 100%;" src="imagens/robo-branco.png" alt="Perfil do assistente">
                <span style="font-size: 1.5em;">Guardinha</span>
            </div>
            <!-- add imagem de um X -->
            <button style="background: none; border: none; color: white; cursor: pointer; font-size: 2em;"
                onclick="fecharChat()">᰽</button>
        </div>
        <div id="corpoChat" class="corpo-chat">
            <div class="mensagem assistente">
                Olá! <br>
                Me chamo Guardinha e sou a assistente virtual da RunGuard. <br>
                <b>Como posso ajudar?</b>
            </div>
            <div class="hora-mensagem assistente" id="horaDeAbertura"></div> <!-- add pelo id a hora -->
        </div>
        <div class="rodape-chat">
            <input type="text" id="entradaUsuario" placeholder="Escreva sua mensagem..." />
            <button onclick="gerarResposta()">⟹</button>
        </div>
    </div>

    <nav>
        <ul>
            <li>
                <a href="index.html" class="logo">
                    <img src="imagens/logo.png" alt="Logo RunGuard">
                    <span class="nav-item">RUNGUARD</span>
                </a>
            </li>
            <li><a href="index.html">
                    <i class="fas fa-home"></i>
                    <span class="nav-item">Home</span>
                </a></li>
            <li><a href="Dashboard - Ale.html">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-item">Dashboard 1</span>
                </a></li>
            <li><a href="Dashboard - Anne.html">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-item">Dashboard 2</span>
                </a></li>
            <li><a href="Dashboard - Diego.html">
                    <i class="fas fa-chart-pie"></i>
                    <span class="nav-item">Dashboard 3</span>
                </a></li>
            <li><a href="Dashboard - Guilherme.html">
                    <i class="fas fa-chart-column"></i>
                    <span class="nav-item">Dashboard 4</span>
                </a></li>
            <li><a href="Dashboard - Ilys.html">
                    <i class="fas fa-chart-simple"></i>
                    <span class="nav-item">Dashboard 5</span>
                </a></li>
            <li><a href="Dashboard - Lucas.html">
                    <i class="fas fa-chart-area"></i>
                    <span class="nav-item">Dashboard 6</span>
                </a></li>
            <li><a href="Dashboard - GuilhermeAlerta.html">
                    <i class="fas fa-chart-column"></i>
                    <span class="nav-item">Dashboard 7</span>
                </a></li>
            <li> <a href="insights-run-guard.pdf" download>
                    <i class="fas fa-file-pdf"></i>
                    <span class="nav-item">Baixe seus relatórios!</span>
                </a></li>
            <li><a href="#" class="sair">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="nav-item">Sair</span>
                </a></li>
        </ul>
    </nav>

    <div class="fundo">
        <div class="medias">
            <div class="medias">
                <div class="data-atual media">
                    <p>Data de hoje:</p>
                    <span id="dataAtual"></span>
                </div>

                <div class="ultima-medida media">
                    <p>Servidor com maior uso de CPU:</p>
                    <span id="servidorMaiorCPU">Servidor 1 (90%)</span>
                </div>
                <div class="mediaAlerta media">
                    <p>Servidor em Estado crítico:</p>
                    <span id="servidorDowtime" style="color: #ff7272;">Servidor 1</span>
                    <p>
                        <a href="Dashboard%20-%20Guilherme.html" style="color: #ff4500; font: bold;">
                            Para acessar o servidor, clique aqui.
                        </a>
                    </p>
                </div>
                <div class="qtdAcima80 media">
                    <p>Servidor com maior uso de RAM:</p>
                    <span id="servidorMaiorRAM">Servidor 1 (78%)</span>
                </div>

            </div>
        </div>

        <div class="alinhamento2">
            <!-- Tabela abaixo dos gráficos -->
            <div class="fundo_grafico-ranking">
                <h2 style="color: #FFFFFF; text-align: center; margin-bottom: 20px;">Ranking de Servidores com Mais
                    Alertas</h2>
                <div id="graficoRanking" style="height: 400px; margin-bottom: 20px;"></div>
                <!-- <table>
                    <thead>
                        <tr>
                            <th>Posição</th>
                            <th>Servidor</th>
                            <th>Total de Alertas</th>
                            <th>Horários de Pico</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Servidor 1</td>
                            <td>6</td>
                            <td>09:00, 12:00, 15:00</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Servidor 4</td>
                            <td>4</td>
                            <td>10:00, 14:00</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Servidor 3</td>
                            <td>3</td>
                            <td>11:00</td>
                        </tr>
                    </tbody>
                </table> -->
            </div>
            <div class="fundo_grafico-tabela">
                <h2 style="color: #FFFFFF; text-align: center; margin-bottom: 20px;">Estado atual geral dos servidores
                </h2>
                <table class="tabelinha">
                    <thead>
                        <tr>
                            <th>Servidor</th>
                            <th>Uso de CPU (%)</th>
                            <th>Uso de RAM (%)</th>
                            <th>Latência (ms)</th>
                            <th>Status Geral</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Servidor 1</td>
                            <td>90%</td>
                            <td>78%</td>
                            <td>185 ms</td>
                            <td>Normal</td>
                        </tr>
                        <tr>
                            <td>Servidor 2</td>
                            <td>23.45%</td>
                            <td>67.89%</td>
                            <td>135.67 ms</td>
                            <td>Normal</td>
                        </tr>
                        <tr>
                            <td>Servidor 3</td>
                            <td>58.32%</td>
                            <td>42.51%</td>
                            <td>190.11 ms</td>
                            <td>Sobrecarga</td>
                        </tr>
                        <tr>
                            <td>Servidor 4</td>
                            <td>94.15%</td>
                            <td>56.83%</td>
                            <td>124.89 ms</td>
                            <td>Normal</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</html>
</body>
<script>
    // Função para obter e formatar a data atual
    function atualizarData() {
        const dataAtual = new Date();
        const dia = String(dataAtual.getDate()).padStart(2, '0');
        const mes = String(dataAtual.getMonth() + 1).padStart(2, '0'); // Janeiro é 0
        const ano = dataAtual.getFullYear();

        // Formata a data no estilo DD/MM/AAAA
        document.getElementById('dataAtual').textContent = `${dia}/${mes}/${ano}`;
    }

    // Atualiza a data ao carregar a página
    atualizarData();

    // Dados do gráfico
    const dataRanking = {
        series: [
            {
                name: 'Total de Alertas',
                data: [6, 4, 3] // Total de alertas por servidor
            }
        ],
        chart: {
            type: 'bar',
            height: 250,
        },
        plotOptions: {
            bar: {
                horizontal: true,
                barHeight: '50%',
                distributed: true, // Para cores diferentes
            },
        },
        colors: ['#FF4560', '#73B7FF', '#FFDC60'], // Primeiro, segundo e terceiro lugares
        dataLabels: {
            enabled: true,
            style: {
                colors: ['#fff']
            },
            formatter: function (val) {
                return `${val} alertas`;
            },
        },
        xaxis: {
            categories: ['Servidor 1', 'Servidor 4', 'Servidor 3'], // Nomes dos servidores
            labels: {
                style: {
                    colors: ['#fff', '#fff', '#fff'], // Cor branca para cada rótulo
                    fontSize: '12px'
                },
            },
        },

        yaxis: {
            labels: {
                style: {
                    colors: ['#ffffff'], // Cor branca para os rótulos do eixo y
                    fontSize: '14px',
                }
            },
            title: {
                style: {
                    color: '#ffffff', // Cor branca para o título do eixo y
                    fontSize: '12px',
                }
            },
        },
        tooltip: {
            theme: 'dark',
        },
        legend: {
            labels: {
                colors: '#fff', // Cor branca para os textos da legenda
            },
            markers: {
                fillColors: ['#FF4560', '#73B7FF', '#FFDC60'], // Cores correspondentes às barras
            },
            position: 'bottom', // Posiciona a legenda na parte inferior
        },
    };

    // Renderização do gráfico
    const graficoRanking = new ApexCharts(document.querySelector("#graficoRanking"), dataRanking);
    graficoRanking.render();


    // Selecione todas as células da tabela
    const tds = document.querySelectorAll('.fundo_grafico-tabela td');

    // Verifique o conteúdo de cada célula e adicione a classe correspondente
    tds.forEach(td => {
        if (td.textContent.includes("Normal")) {
            td.style.color = '#ffffff'; // Altere para a cor desejada
            td.style.fontWeight = 'bold';
        }
        if (td.textContent.includes("Sobrecarga")) {
            td.style.color = '#FF2D00'; // Cor vibrante para sobrecarga
            td.style.fontWeight = 'bold'; // Para dar destaque
        }
    });




    
    function abrirChat() {
        document.getElementById("janelaChat").style.display = "flex";
    }

    function fecharChat() {
        document.getElementById("janelaChat").style.display = "none";
    }

    function obterHoraAtual() {
        const options = {
            timeZone: 'America/Sao_Paulo',
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
        };
        const agora = new Date();
        return agora.toLocaleTimeString('pt-BR', options);
    }

    async function gerarResposta() {
        const pergunta = document.getElementById('entradaUsuario').value;

        var entrada = document.getElementById("entradaUsuario");
        var mensagem = entrada.value.trim();

        const response = await fetch('/perguntar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ pergunta })
        });

        const data = await response.json();

        conversa.push(mensagem)
        conversa.push(data.resultado)

        if (mensagem !== "") {
            var mensagemUsuario = document.createElement("div");
            mensagemUsuario.classList.add("mensagem", "usuario");
            mensagemUsuario.innerText = mensagem;
            document.getElementById("corpoChat").appendChild(mensagemUsuario);

            var horaUsuario = document.createElement("div");
            horaUsuario.classList.add("hora-mensagem");
            horaUsuario.innerText = obterHoraAtual();
            document.getElementById("corpoChat").appendChild(horaUsuario);

            entrada.value = "";

            setTimeout(function () {
                var mensagemAssistente = document.createElement("div");
                mensagemAssistente.classList.add("mensagem", "assistente");
                mensagemAssistente.innerText = data.resultado;
                document.getElementById("corpoChat").appendChild(mensagemAssistente);

                var horaAssistente = document.createElement("div");
                horaAssistente.classList.add("hora-mensagem", "assistente");
                horaAssistente.innerText = obterHoraAtual();
                document.getElementById("corpoChat").appendChild(horaAssistente);

                document.getElementById("corpoChat").scrollTop = document.getElementById("corpoChat").scrollHeight;
            }, 1000);

            document.getElementById("corpoChat").scrollTop = document.getElementById("corpoChat").scrollHeight;
        }
    }
</script>